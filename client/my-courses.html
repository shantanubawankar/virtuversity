<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Courses â€¢ Virtuversity</title>
    <meta name="theme-color" content="#111827" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/site.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      html, body { height: 100%; }
      :root { color-scheme: dark; }
      html { scroll-behavior: smooth; }
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; }
      .glass { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.18); box-shadow: 0 8px 32px rgba(31,38,135,0.15); backdrop-filter: blur(10px); }
    </style>
  </head>
  <body class="min-h-screen bg-gradient-to-br from-[#0f172a] via-[#111827] to-[#1f2937] text-white">
    <header class="sticky top-0 z-50 flex items-center justify-between px-6 py-4 bg-black/20 backdrop-blur border-b border-white/10">
      <div class="text-xl font-semibold">Virtuversity</div>
      <nav class="nav flex items-center gap-2 text-sm">
        <a href="/" class="px-3 py-2 rounded hover:bg-white/10">Home</a>
        <a href="/courses" class="px-3 py-2 rounded hover:bg-white/10">Courses</a>
        <a href="/teachers" class="px-3 py-2 rounded hover:bg-white/10">Teachers</a>
        <a href="/my-courses" class="px-3 py-2 rounded bg-white/10">My Courses</a>
        <a href="/video" class="px-3 py-2 rounded hover:bg-white/10">Video</a>
        <a href="/payments" class="px-3 py-2 rounded hover:bg-white/10">Payments</a>
        <a href="/login" class="px-3 py-2 rounded hover:bg-white/10">Login</a>
        <a href="/profile" class="px-3 py-2 rounded hover:bg-white/10">Profile</a>
      </nav>
    </header>
    <main class="max-w-4xl mx-auto p-6">
      <section class="glass rounded-xl p-6">
        <h1 class="text-2xl font-bold mb-4">My Courses</h1>
        <div id="status" class="text-white/80 mb-4"></div>
        <div id="enrolledList" class="grid md:grid-cols-2 gap-4"></div>
      </section>
    </main>
    <script>
      async function api(path, { method = 'GET', body, headers } = {}) {
        let res
        try {
          res = await fetch(path, {
            method,
            headers: Object.assign({}, body ? { 'Content-Type': 'application/json' } : {}, headers || (localStorage.getItem('token') ? { Authorization: `Bearer ${localStorage.getItem('token')}` } : {})),
            credentials: 'include',
            body: body ? JSON.stringify(body) : undefined
          });
        } catch (e) {
          res = await fetch(`https://virtuversity.onrender.com${path}`, {
            method,
            headers: Object.assign({}, body ? { 'Content-Type': 'application/json' } : {}, headers || (localStorage.getItem('token') ? { Authorization: `Bearer ${localStorage.getItem('token')}` } : {})),
            credentials: 'include',
            body: body ? JSON.stringify(body) : undefined
          }).catch(() => { throw new Error('Network error') })
        }
        const ct = res.headers.get('content-type') || '';
        if (!res.ok) {
          let errText = 'Request failed';
          try {
            if (ct.includes('application/json')) {
              const j = await res.json();
              errText = j.error || JSON.stringify(j);
            } else {
              errText = await res.text();
            }
          } catch {}
          throw new Error(errText);
        }
        if (ct.includes('application/json')) return res.json();
        return res.text();
      }
      async function load() {
        const status = document.getElementById('status');
        try {
          const me = await api('/api/auth/me');
          status.textContent = `Logged in as ${me.user.email}`;
        } catch {
          status.textContent = 'Please login to view your courses';
          return;
        }
        const allCourses = await api('/api/courses').then(r => r.courses);
        const byId = Object.fromEntries(allCourses.map(c => [c.id, c]));
        const enrs = await api('/api/enrollments/me').then(r => r.enrollments);
        const root = document.getElementById('enrolledList');
        root.innerHTML = '';
        enrs.forEach(e => {
          const c = byId[e.courseId] || { title: e.courseId };
          const card = document.createElement('div');
          card.className = 'rounded p-4 bg-white/10';
          const title = document.createElement('div');
          title.className = 'font-semibold';
          title.textContent = c.title;
          const when = document.createElement('div');
          when.className = 'text-white/80 text-sm mt-1';
          const dt = new Date(e.at);
          when.textContent = `Enrolled on ${dt.toLocaleDateString()} ${dt.toLocaleTimeString()}`;
          const link = document.createElement('a');
          link.href = `/courses/${e.courseId}`;
          link.className = 'btn btn-primary text-sm mt-3';
          link.textContent = 'Go to course';
          card.appendChild(title);
          card.appendChild(when);
          card.appendChild(link);
          root.appendChild(card);
        });
        if (enrs.length === 0) {
          root.innerHTML = '<div class="text-white/60">No enrollments yet.</div>';
        }
      }
      load();
    </script>
    <script src="/ui.js"></script>
  </body>
</html>
